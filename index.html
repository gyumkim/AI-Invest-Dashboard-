<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI íˆ¬ì ëŒ€ì‹œë³´ë“œ (Gemini API)</title>
    <style>
        /* CSS ì‹œì‘ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #0d1117;
            color: #c9d1d9;
            margin: 0;
            padding: 20px;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: auto;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
            background-color: #161b22;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .chart-section, .info-panel {
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
        }

        .chart-section {
            background-color: #010409;
        }

        .chart-placeholder {
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: #4a545e;
            text-align: center;
        }

        .info-panel {
            display: grid;
            grid-template-rows: repeat(3, 1fr);
            gap: 15px;
            background-color: #1c2128;
        }

        h2 {
            margin-top: 0;
            border-bottom: 1px solid #30363d;
            padding-bottom: 5px;
        }

        ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        li {
            padding: 8px 0;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        li:hover {
            background-color: #30363d;
        }

        .stock-list li {
            display: flex;
            justify-content: space-between;
        }

        .stock-change {
            font-weight: bold;
        }

        .stock-change.positive {
            color: #34d399; /* Green */
        }

        .stock-change.negative {
            color: #f87171; /* Red */
        }

        .discussion-section {
            display: grid;
            grid-template-rows: auto 1fr auto;
            gap: 10px;
        }

        .discussion-box {
            height: 150px;
            overflow-y: auto;
            padding: 10px;
            background-color: #0d1117;
            border: 1px solid #30363d;
            border-radius: 4px;
        }

        .message {
            margin-bottom: 5px;
        }
        
        .user-message {
            text-align: right;
        }

        .ai-message {
            text-align: left;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #30363d;
            border-radius: 4px;
            background-color: #0d1117;
            color: #c9d1d9;
        }

        .chat-input button {
            background-color: #38a169;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .chat-input button:hover {
            background-color: #277953;
        }

        .summary-btn {
            background-color: #38a169;
            color: #fff;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
            margin-top: 10px;
        }

        .summary-btn:hover {
            background-color: #277953;
        }

        .loader {
            display: none;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 2s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .news-item {
            cursor: pointer;
            padding: 8px 0;
        }

        .news-item:hover {
            background-color: #2d343c;
        }

        .popup {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
        }

        .popup-content {
            background-color: #1c2128;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-height: 80%;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #c9d1d9;
        }
        /* CSS ë */
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header class="header">
            <h1>AI Investment Dashboard ğŸ“Š</h1>
        </header>

        <main class="main-content">
            <div class="chart-section">
                <h2>ì£¼ì‹ ì°¨íŠ¸</h2>
                <div class="chart-placeholder">
                    <span>(ì¸í„°ë™í‹°ë¸Œ ì°¨íŠ¸ ì˜ì—­)<br>ì¢…ëª©ì„ í´ë¦­í•˜ì—¬ ìì„¸í•œ ì°¨íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.</span>
                </div>
            </div>

            <div class="info-panel">
                <div class="stock-list">
                    <h2>ì£¼ìš” ì§€ìˆ˜/ì¢…ëª©</h2>
                    <ul id="stock-list">
                        <li data-stock="stock1">
                            <span class="stock-name">S&P 500</span>
                            <span class="stock-price">5,200.50</span>
                            <span class="stock-change positive">+0.85%</span>
                        </li>
                        <li data-stock="stock2">
                            <span class="stock-name">NASDAQ</span>
                            <span class="stock-price">18,345.10</span>
                            <span class="stock-change negative">-0.55%</span>
                        </li>
                        <li data-stock="stock3">
                            <span class="stock-name">Apple (AAPL)</span>
                            <span class="stock-price">220.15</span>
                            <span class="stock-change positive">+1.20%</span>
                        </li>
                    </ul>
                </div>
                <div class="news-section">
                    <h2>AI ê¸°ë°˜ ë‰´ìŠ¤ ìš”ì•½ ğŸ“°</h2>
                    <ul id="news-list">
                        <li class="news-item" data-full-text="ìµœê·¼ ë°œí‘œëœ ë³´ê³ ì„œì— ë”°ë¥´ë©´, ì¸ê³µì§€ëŠ¥(AI) ê¸°ìˆ ì´ ë°˜ë„ì²´ ì‚°ì—…ì˜ ìƒˆë¡œìš´ ì„±ì¥ ë™ë ¥ìœ¼ë¡œ ê°•ë ¥í•˜ê²Œ ë¶€ìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤. AI ì¹© ìˆ˜ìš”ëŠ” ê¸‰ì¦í•˜ê³  ìˆìœ¼ë©°, ì´ëŠ” ê¸°ì¡´ ë°˜ë„ì²´ ì‹œì¥ì˜ ê·œëª¨ë¥¼ í›¨ì”¬ ë›°ì–´ë„˜ëŠ” ì ì¬ë ¥ì„ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤. NVIDIA, AMDì™€ ê°™ì€ ê¸°ì—…ë“¤ì´ AI ì¹© ì‹œì¥ì„ ì„ ë„í•˜ë©° ìƒˆë¡œìš´ íˆ¬ìì˜ ê¸°íšŒë¥¼ ì°½ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤.">AI, ë°˜ë„ì²´ ì‚°ì—…ì˜ ìƒˆë¡œìš´ ì„±ì¥ ë™ë ¥ìœ¼ë¡œ ë¶€ìƒ</li>
                        <li class="news-item" data-full-text="Apple(AAPL)ì´ êµ¬ê¸€ ì œë¯¸ë‹ˆ AIë¥¼ Siriì— í†µí•©í•˜ëŠ” ë°©ì•ˆì„ ë…¼ì˜ ì¤‘ì´ë¼ëŠ” ì†Œì‹ì´ ì „í•´ì¡ŒìŠµë‹ˆë‹¤. ì´ëŠ” Appleì˜ AI ì „ëµì— í° ë³€í™”ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ì¤‘ìš”í•œ ì›€ì§ì„ìœ¼ë¡œ, ì–‘ì‚¬ ê°„ì˜ í˜‘ë ¥ ê°€ëŠ¥ì„±ì— íˆ¬ììë“¤ì˜ ì´ëª©ì´ ì§‘ì¤‘ë˜ê³  ìˆìŠµë‹ˆë‹¤.">Apple, êµ¬ê¸€ Gemini AI íƒ‘ì¬ Siriì— í†µí•© ë…¼ì˜</li>
                        <li class="news-item" data-full-text="Appleì€ ì°¨ì„¸ëŒ€ ì•„ì´í°ê³¼ ë§¥ë¶ì„ ê³µê°œí•˜ë©° ì‹œì¥ì˜ ê¸°ëŒ€ë¥¼ ë›°ì–´ë„˜ëŠ” ì„±ëŠ¥ì„ ì„ ë³´ì˜€ìŠµë‹ˆë‹¤. íŠ¹íˆ, ìƒˆë¡œìš´ AI ê¸°ëŠ¥ì´ íƒ‘ì¬ëœ ìš´ì˜ì²´ì œëŠ” ì‚¬ìš©ì ê²½í—˜ì„ í˜ì‹ ì ìœ¼ë¡œ ê°œì„ í•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤. ì „ë¬¸ê°€ë“¤ì€ ì´ë²ˆ ì‹ ì œí’ˆ ë°œí‘œê°€ Appleì˜ ì£¼ê°€ì— ê¸ì •ì ì¸ ì˜í–¥ì„ ë¯¸ì¹  ê²ƒìœ¼ë¡œ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤.">Apple, ì‹ ì œí’ˆ ë°œí‘œë¡œ ì‹œì¥ ì˜ˆìƒì¹˜ ìƒíšŒ</li>
                        <li class="news-item" data-full-text="ë¯¸êµ­ ì—°ë°©ì¤€ë¹„ì œë„(Fed)ì˜ ë‹¤ìŒ ê¸ˆë¦¬ ì¸ìƒ ë˜ëŠ” ì¸í•˜ ê²°ì •ì´ ì„ë°•í–ˆìŠµë‹ˆë‹¤. ì´ë²ˆ ë°œí‘œëŠ” ì „ ì„¸ê³„ ê¸ˆìœµ ì‹œì¥ì— í° ì˜í–¥ì„ ë¯¸ì¹  ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. íˆ¬ììë“¤ì€ Fedì˜ ë°œí‘œ ë‚´ìš©ì„ ì£¼ì‹œí•˜ë©° í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ì¡°ì •í•˜ê³  ìˆìœ¼ë©°, ì‹œì¥ì˜ ë³€ë™ì„±ì´ í™•ëŒ€ë  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.">ì—°ì¤€ ê¸ˆë¦¬ ë°œí‘œ ì„ë°•, ì‹œì¥ ë³€ë™ì„± í™•ëŒ€</li>
                    </ul>
                </div>
                <div class="discussion-section">
                    <h2>ë¡œë´‡ê³¼ í† ë¡  ğŸ§ </h2>
                    <div class="discussion-box" id="discussion-box">
                        <div class="message ai-message">
                            <strong>AI_Bot:</strong> ë¬´ì—‡ì´ ê¶ê¸ˆí•˜ì‹ ê°€ìš”? ì‹œì¥ ë™í–¥ì´ë‚˜ íŠ¹ì • ì¢…ëª©ì— ëŒ€í•´ ì§ˆë¬¸í•´ì£¼ì„¸ìš”.
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="user-input" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...">
                        <button id="send-btn">ì „ì†¡</button>
                    </div>
                    <button class="summary-btn" id="market-analysis-btn">ì‹œì¥ ë™í–¥ ë¶„ì„í•˜ê¸°</button>
                    <div id="loader" class="loader"></div>
                </div>
            </div>
        </main>
    </div>

    <div id="popup" class="popup">
        <div class="popup-content">
            <span class="close-btn" id="close-popup">&times;</span>
            <h3 id="popup-title"></h3>
            <p id="popup-text"></p>
        </div>
    </div>

    <script>
        // JavaScript ì‹œì‘
        document.addEventListener('DOMContentLoaded', () => {
            const stockList = document.getElementById('stock-list');
            const newsList = document.getElementById('news-list');
            const marketAnalysisBtn = document.getElementById('market-analysis-btn');
            const discussionBox = document.getElementById('discussion-box');
            const loader = document.getElementById('loader');
            const chartPlaceholder = document.querySelector('.chart-placeholder span');
            const userInput = document.getElementById('user-input');
            const sendBtn = document.getElementById('send-btn');

            const popup = document.getElementById('popup');
            const popupTitle = document.getElementById('popup-title');
            const popupText = document.getElementById('popup-text');
            const closePopupBtn = document.getElementById('close-popup');

            const stockData = {
                'stock1': 'S&P 500 ì°¨íŠ¸ì…ë‹ˆë‹¤. (ì‹¤ì œ ë°ì´í„° ì—°ë™ í•„ìš”)',
                'stock2': 'NASDAQ ì°¨íŠ¸ì…ë‹ˆë‹¤. (ì‹¤ì œ ë°ì´í„° ì—°ë™ í•„ìš”)',
                'stock3': 'Apple (AAPL) ì°¨íŠ¸ì…ë‹ˆë‹¤. (ì‹¤ì œ ë°ì´í„° ì—°ë™ í•„ìš”)'
            };

            stockList.addEventListener('click', (event) => {
                const clickedItem = event.target.closest('li');
                if (clickedItem) {
                    const stockId = clickedItem.getAttribute('data-stock');
                    const newChartText = stockData[stockId] || 'ì°¨íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                    chartPlaceholder.textContent = newChartText;
                }
            });

            // ë‰´ìŠ¤ ìš”ì•½ ê¸°ëŠ¥
            newsList.addEventListener('click', async (event) => {
                const newsItem = event.target.closest('li');
                if (newsItem) {
                    const fullText = newsItem.getAttribute('data-full-text');
                    const newsTitle = newsItem.textContent;
                    
                    loader.style.display = 'inline-block';
                    popupTitle.textContent = newsTitle;
                    popupText.textContent = 'ë‰´ìŠ¤ ìš”ì•½ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.';
                    popup.style.display = 'flex';

                    try {
                        const prompt = `ë‹¤ìŒ ë‰´ìŠ¤ ê¸°ì‚¬ë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ ìš”ì•½í•´ ì£¼ì„¸ìš”: "${fullText}"`;
                        const summary = await callGeminiAPI(prompt);
                        
                        popupText.textContent = summary;
                    } catch (error) {
                        popupTitle.textContent = 'ì˜¤ë¥˜ ë°œìƒ';
                        popupText.textContent = 'ìš”ì•½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
                        console.error('Gemini API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                    } finally {
                        loader.style.display = 'none';
                    }
                }
            });

            // ë¡œë´‡ê³¼ í† ë¡  ê¸°ëŠ¥
            const sendMessage = async () => {
                const userMessage = userInput.value.trim();
                if (userMessage === '') return;

                // ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ í† ë¡  ìƒìì— ì¶”ê°€
                const userMsgElement = document.createElement('div');
                userMsgElement.classList.add('message', 'user-message');
                userMsgElement.innerHTML = `<strong>ì‚¬ìš©ì:</strong> ${userMessage}`;
                discussionBox.appendChild(userMsgElement);
                userInput.value = '';
                discussionBox.scrollTop = discussionBox.scrollHeight;

                // AI ì‘ë‹µ ë¡œë”© í‘œì‹œ
                const aiLoadingElement = document.createElement('div');
                aiLoadingElement.classList.add('message', 'ai-message');
                aiLoadingElement.innerHTML = `<strong>AI_Bot:</strong> ...`;
                discussionBox.appendChild(aiLoadingElement);
                discussionBox.scrollTop = discussionBox.scrollHeight;

                try {
                    const prompt = `ë‹¹ì‹ ì€ íˆ¬ì ì‹œì¥ì˜ ë™í–¥ì„ ì „ë¬¸ì ìœ¼ë¡œ ë¶„ì„í•˜ëŠ” AI ì±—ë´‡ì…ë‹ˆë‹¤. ë‹¤ìŒ ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ëŒ€í•´ ì „ë¬¸ì ì´ê³  ê°„ê²°í•˜ê²Œ ë‹µë³€í•´ì£¼ì„¸ìš”: "${userMessage}"`;
                    const aiResponse = await callGeminiAPI(prompt);

                    // ë¡œë”© ë©”ì‹œì§€ë¥¼ ì‹¤ì œ ì‘ë‹µìœ¼ë¡œ êµì²´
                    aiLoadingElement.innerHTML = `<strong>AI_Bot:</strong> ${aiResponse}`;
                } catch (error) {
                    aiLoadingElement.innerHTML = `<strong>AI_Bot:</strong> ì£„ì†¡í•©ë‹ˆë‹¤. ì§€ê¸ˆì€ ë‹µë³€ì„ ë“œë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
                    console.error('Gemini API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                } finally {
                    discussionBox.scrollTop = discussionBox.scrollHeight;
                }
            };
            
            sendBtn.addEventListener('click', sendMessage);
            userInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    sendMessage();
                }
            });


            // ì‹œì¥ ë™í–¥ ë¶„ì„ ê¸°ëŠ¥ (ë¡œë´‡ í† ë¡  ë‚´ìš© í¬í•¨)
            marketAnalysisBtn.addEventListener('click', async () => {
                const discussionText = discussionBox.innerText;
                const newsText = Array.from(document.querySelectorAll('#news-list li'))
                                    .map(item => item.textContent.trim())
                                    .join('; ');

                const prompt = `í˜„ì¬ ëŒ€ì‹œë³´ë“œì— í‘œì‹œëœ í† ë¡  ë‚´ìš©ê³¼ ì‹œì¥ ë‰´ìŠ¤ë¥¼ ì¢…í•©í•˜ì—¬ AI íˆ¬ì ì‹œì¥ì˜ ì „ë°˜ì ì¸ ë™í–¥ì„ í•œ ë¬¸ë‹¨ìœ¼ë¡œ ë¶„ì„í•˜ê³ , í–¥í›„ ì „ë§ì— ëŒ€í•œ ì˜ê²¬ì„ ì œì‹œí•´ ì£¼ì„¸ìš”.
                
                <í† ë¡  ë‚´ìš©>
                ${discussionText}
                
                <ì‹œì¥ ë‰´ìŠ¤>
                ${newsText}
                `;

                loader.style.display = 'inline-block';
                popupTitle.textContent = 'ì‹œì¥ ë™í–¥ ë¶„ì„ ì¤‘...';
                popupText.textContent = 'ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.';
                popup.style.display = 'flex';
                
                try {
                    const analysis = await callGeminiAPI(prompt);
                    popupTitle.textContent = 'ì˜¤ëŠ˜ì˜ ì‹œì¥ ë™í–¥ ë¶„ì„';
                    popupText.textContent = analysis;
                } catch (error) {
                    popupTitle.textContent = 'ì˜¤ë¥˜ ë°œìƒ';
                    popupText.textContent = 'ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
                    console.error('Gemini API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                } finally {
                    loader.style.display = 'none';
                }
            });

            // íŒì—… ë‹«ê¸°
            closePopupBtn.addEventListener('click', () => {
                popup.style.display = 'none';
            });
            window.addEventListener('click', (event) => {
                if (event.target === popup) {
                    popup.style.display = 'none';
                }
            });

            // Gemini API í˜¸ì¶œ í•¨ìˆ˜
            async function callGeminiAPI(prompt) {
                const apiKey = "AIzaSyBFzE8yoVdxLcHfnjGuYDKoMWDVh4K1J0Y";a ì—¬ê¸°ì— ì‹¤ì œ Gemini API í‚¤ë¥¼ ë„£ì–´ì£¼ì„¸ìš”.

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`;
                
                let response = null;
                let retryCount = 0;
                const maxRetries = 5;
                let delay = 1000;

                while (retryCount < maxRetries) {
                    try {
                        response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                        });

                        if (response.ok) {
                            const result = await response.json();
                            if (result.candidates && result.candidates.length > 0) {
                                return result.candidates[0].content.parts[0].text;
                            }
                        }

                        if (response.status === 429) {
                            console.log(`Rate limit exceeded. Retrying in ${delay}ms...`);
                            await new Promise(res => setTimeout(res, delay));
                            delay *= 2;
                            retryCount++;
                        } else {
                            throw new Error(`API returned status code ${response.status}`);
                        }

                    } catch (error) {
                        console.error('API call failed:', error);
                        throw error;
                    }
                }
                throw new Error('Max retries exceeded. Failed to get a response from the API.');
            }
        });
        // JavaScript ë
    </script>
</body>
</html>
